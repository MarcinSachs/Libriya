{% extends "layout.html" %}
{% block content %}

<div class="container">

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
    {% endif %}
    {% endwith %}


    <div class="book-count-card">
        <i class='bx bxs-info-circle'></i>
        <p class="mb-0">
            {% set n = books|length %}
            {{ ngettext('Library currently has %(n)s book.', 'Library currently has %(n)s books.', n, n=n) }}
        </p>
    </div>

    <h2>{{ _('List of books') }}</h2>

    <table class="table table-hover table-striped">
        <thead>
            <tr>
                <th>{{ _('Cover') }}</th>
                <th>{{ _('Title') }}</th>
                <th>{{ _('Author') }}</th>
                <th>{{ _('Genre') }}</th>
                <th>{{ _('Year') }}</th>
                <th>{{ _('Status') }}</th>
                <th>{{ _('Actions') }}</th>
            </tr>
        </thead>
        <tbody>
            {% for book in books %}
            <tr>
                <td>
                    {% if book.cover %}

                    <img src="{{ url_for('static', filename='uploads/' + book.cover) }}"
                        alt="{{ _('Book cover %(title)s', title=book.title) }}">
                    {% else %}

                    <i class='bx bx-image'></i>
                    {% endif %}
                </td>
                <td>{{ book.title }}</td>
                <td>{{ book.authors|map(attribute='name')|join(', ') }}</td>
                <td>{{ book.genre }}</td>
                <td>{{ book.year }}</td>
                <td>{{ _('Available') if book.is_available else _('On loan') }}</td>

                <td class="text-nowrap">
                    {% if book.is_available %}
                    <a href="{{ url_for('main.borrow_book', book_id=book.id, user_id=current_user.id) }}"
                        class="btn btn-outline-success btn-sm" data-bs-toggle="tooltip" data-bs-placement="top"
                        title="{{ _('Borrow Book') }}"><i class="bx bx-log-in-circle"></i></a>
                    {% else %}
                    <a href="{{ url_for('main.return_book', book_id=book.id) }}" class="btn btn-outline-warning btn-sm"
                        data-bs-toggle="tooltip" data-bs-placement="top" title="{{ _('Return Book') }}"><i
                            class="bx bx-log-out-circle"></i></a>
                    {% endif %}
                    {% if current_user and current_user.is_admin %}
                    <a href="{{ url_for('main.book_edit', book_id=book.id)}}" class="btn btn-outline-primary btn-sm"
                        data-bs-toggle="tooltip" data-bs-placement="top" title="{{ _('Edit Book') }}"><i
                            class="bx bx-edit"></i></a>
                    <a href="{{ url_for('main.book_delete', book_id=book.id)}}" class="btn btn-outline-danger btn-sm"
                        data-bs-toggle="tooltip" data-bs-placement="top" title="{{ _('Delete Book') }}"><i
                            class="bx bx-trash"></i></a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% if current_user and current_user.is_admin %}
    <a href="{{ url_for('main.book_add') }}" class="btn btn-primary add-book-btn">{{ _('Add book') }}
    </a>
    {% endif %}
</div>
{% endblock %}