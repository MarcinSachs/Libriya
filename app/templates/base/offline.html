{% extends "base/main_base.html" %}
{% block content %}
<div class="max-w-7xl mx-auto px-4">
    <!-- Offline Banner -->
    <div class="mb-6 p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded">
        <div class="flex items-start">
            <span class="text-2xl mr-3">üì°</span>
            <div>
                <h3 class="font-bold text-yellow-800">{{ _('You are currently offline') }}</h3>
                <p class="text-sm text-yellow-700 mt-1">{{ _('Only cached content is available. Go online to access all features.') }}</p>
            </div>
        </div>
    </div>

    <!-- What's Available Offline -->
    <div class="grid md:grid-cols-2 gap-6 mb-8">
        <div class="bg-green-50 border border-green-200 rounded-lg p-6">
            <h4 class="font-bold text-green-800 mb-4 flex items-center">
                <span class="mr-2">‚úÖ</span> {{ _('Available offline (after download)') }}
            </h4>
            <ul class="space-y-2">
                <li class="text-sm text-green-800">üìö {{ _('Browse cached books') }}</li>
                <li class="text-sm text-green-800">üìñ {{ _('Read book details & covers') }}</li>
                <li class="text-sm text-green-800">üë§ {{ _('View your profile') }}</li>
                <li class="text-sm text-green-800">‚è±Ô∏è {{ _('Check loan history') }}</li>
                <li class="text-xs text-green-700 mt-3 pt-3 border-t border-green-200">‚úì {{ _('Downloaded in "Offline Mode" settings') }}</li>
            </ul>
        </div>
        
        <div class="bg-red-50 border border-red-200 rounded-lg p-6">
            <h4 class="font-bold text-red-800 mb-4 flex items-center">
                <span class="mr-2">‚ùå</span> {{ _('Requires internet') }}
            </h4>
            <ul class="space-y-2">
                <li class="text-sm text-red-800">üîç {{ _('Search books') }}</li>
                <li class="text-sm text-red-800">‚ûï {{ _('Add new books') }}</li>
                <li class="text-sm text-red-800">‚öôÔ∏è {{ _('Settings & preferences') }}</li>
                <li class="text-sm text-red-800">üíæ {{ _('Save changes') }}</li>
                <li class="text-sm text-red-800">üìÖ {{ _('Make new loans') }}</li>
            </ul>
        </div>
    </div>

    <!-- Instructions -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8">
        <h4 class="font-bold text-blue-900 mb-3">{{ _('To cache your books for offline:') }}</h4>
        <ol class="space-y-2 text-sm text-blue-800">
            <li class="flex items-start">
                <span class="inline-flex items-center justify-center h-6 w-6 rounded-full bg-blue-600 text-white text-xs font-bold mr-3 flex-shrink-0">1</span>
                <span>{{ _('Go online and open your browser') }}</span>
            </li>
            <li class="flex items-start">
                <span class="inline-flex items-center justify-center h-6 w-6 rounded-full bg-blue-600 text-white text-xs font-bold mr-3 flex-shrink-0">2</span>
                <span>{{ _('Visit Settings (user icon ‚Üí Settings)') }}</span>
            </li>
            <li class="flex items-start">
                <span class="inline-flex items-center justify-center h-6 w-6 rounded-full bg-blue-600 text-white text-xs font-bold mr-3 flex-shrink-0">3</span>
                <span>{{ _('Find "Offline Mode" section') }}</span>
            </li>
            <li class="flex items-start">
                <span class="inline-flex items-center justify-center h-6 w-6 rounded-full bg-blue-600 text-white text-xs font-bold mr-3 flex-shrink-0">4</span>
                <span>{{ _('Click "Download" button to cache your library') }}</span>
            </li>
            <li class="flex items-start">
                <span class="inline-flex items-center justify-center h-6 w-6 rounded-full bg-blue-600 text-white text-xs font-bold mr-3 flex-shrink-0">5</span>
                <span>{{ _('Now you can go offline and view your books') }}</span>
            </li>
        </ol>
    </div>

    <!-- Cached Books Grid -->
    <div id="books-section" style="display: none;">
        <h3 class="text-2xl font-bold mb-4">{{ _('Your Cached Library') }}</h3>
        <div id="books-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-8"></div>
    </div>

    <!-- No Cache Message -->
    <div id="no-cache-section" class="text-center py-12 bg-gray-50 rounded-lg border border-gray-200">
        <div class="text-5xl mb-4">üìö</div>
        <p class="text-gray-600 mb-2">{{ _('No books cached for offline access') }}</p>
        <p class="text-sm text-gray-500">{{ _('Go online and download your library in Settings') }}</p>
    </div>
</div>

<!-- Load offline data manager -->
<script src="{{ url_for('static', filename='js/offline-data.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', async function() {
        console.log('[Offline Page] Initializing...');
        
        if (window.offlineDataManager) {
            try {
                const books = await offlineDataManager.loadCachedBooks();
                console.log('[Offline Page] Loaded', books.length, 'books');
                
                if (books.length > 0) {
                    // Show cached books
                    document.getElementById('no-cache-section').style.display = 'none';
                    document.getElementById('books-section').style.display = 'block';
                    await offlineDataManager.renderBooksList('books-container');
                } else {
                    // Show "no cache" message
                    document.getElementById('no-cache-section').style.display = 'block';
                    document.getElementById('books-section').style.display = 'none';
                }
            } catch (e) {
                console.error('[Offline Page] Error:', e);
                document.getElementById('no-cache-section').style.display = 'block';
                document.getElementById('books-section').style.display = 'none';
            }
        }
    });
</script>
{% endblock %}