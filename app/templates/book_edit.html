{% extends "layout.html" %}
{% block content %}
<div class="container">

    {{ macros.display_flashes() }}
    <h2>{{ _('Edit Book:') }} <span class="text-muted">{{ book.title }}</span></h2>
    <hr>

    <form method="POST" action="" enctype="multipart/form-data" novalidate>

        {{ form.hidden_tag() }}

        {% if book.cover %}
        <div class="form-group mb-3">
            <p class="form-label">{{ _('Current Cover:') }}</p>
            <img src="{{ url_for('static', filename='uploads/' + book.cover) }}"
                alt="{{ _('Current cover for %(title)s', title=book.title) }}"
                style="max-width: 150px; height: auto; border-radius: 4px;">
        </div>
        {% endif %}

        {{ macros.form_field(form.isbn, field_type='text', icon='bx-barcode', placeholder=_("Enter ISBN")) }}
        {{ macros.form_field(form.title, field_type='text', icon='bx-file-alt', placeholder=_("e.g. The Lord of the Rings")) }}
        {{ macros.form_field(form.author, field_type='text', icon='bx-user', placeholder=_("e.g. J.R.R. Tolkien")) }}
        {{ macros.form_field(form.library, field_type='select', icon='bx-building') }}
        {{ macros.form_field(form.genres, field_type='select', icon='bx-tag', help_text=_('Hold Ctrl (or Cmd on Mac) to select multiple genres.')) }}
        {{ macros.form_field(form.year, field_type='number', icon='bx-calendar', placeholder=_("e.g. 1954")) }}
        {{ macros.form_field(form.description, field_type='textarea', icon='bx-align-left', placeholder=_('Enter a description (optional)')) }}
        <div class="form-group mb-3">
            {{ form.cover.label(class="form-label") }}
            <small class="form-text text-muted d-block mb-1">{{ _('Upload a new cover to replace the current one.') }}</small>
            {{ form.cover(class="form-control") }}
            {% for error in form.cover.errors %}<span class="text-danger">{{ error }}</span>{% endfor %}
        </div>

        <!-- Location Section (Optional) -->
        <div class="card mt-4 mb-4">
            <div class="card-header bg-light">
                <h5 class="mb-0">{{ _('Location Information') }} <small class="text-muted">({{ _('Optional') }})</small></h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        {{ macros.form_field(form.shelf, field_type='text', icon='bx-list-ul', placeholder=_("e.g., A, B-1")) }}
                    </div>
                    <div class="col-md-6">
                        {{ macros.form_field(form.section, field_type='text', icon='bx-layer', placeholder=_("e.g., Fiction, Science")) }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        {{ macros.form_field(form.room, field_type='text', icon='bx-door-open', placeholder=_("e.g., Main Hall, Room 2")) }}
                    </div>
                    <div class="col-md-6">
                        {{ macros.form_field(form.location_notes, field_type='textarea', icon='bx-note', placeholder=_("e.g., Top shelf, Near window")) }}
                    </div>
                </div>
            </div>
        </div>

        {{ macros.form_submit(form.submit.label.text, cancel_url=url_for('main.home')) }}
    </form>
</div>
{% endblock %}