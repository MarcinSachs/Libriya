name: Push translations to Lokalise

# IMPORTANT: This workflow requires a PAID Lokalise plan
# The file upload API is not available on the free plan.
# If you're on the free plan, you'll get: "API isn't available on your team's plan"
# Options:
# 1. Upgrade to a paid Lokalise plan
# 2. Disable this workflow and upload files manually via Lokalise web interface
# 3. Use an alternative platform with free API access

on:
  push:
    branches:
      - main
    paths:
      - 'translations/**/*.po'
      - 'messages.pot'
  workflow_dispatch:  # Allow manual trigger

jobs:
  lokalise-push:
    runs-on: ubuntu-latest
    # Add a condition: only run if the LOKALISE_ENABLE_PUSH secret is set to 'true'
    # This allows users on free plan to disable the workflow without deleting the file
    if: vars.LOKALISE_ENABLE_PUSH != 'false'
    permissions:
      contents: read
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Check Lokalise plan compatibility
        run: |
          echo "⚠️  NOTE: This workflow requires a PAID Lokalise plan."
          echo "The file upload API is not available on the free plan."
          echo ""
          echo "If you get an error like 'API isn't available on your team's plan':"
          echo "1. Upgrade to a paid Lokalise plan (Team/Pro/Enterprise), or"
          echo "2. Disable this workflow by setting repository variable LOKALISE_ENABLE_PUSH=false, or"
          echo "3. Upload translation files manually via Lokalise web interface"
          echo ""
          echo "Proceeding with push attempt..."

      - name: Push translation files to Lokalise
        uses: lokalise/lokalise-push-action@v4.1.0
        with:
          api_token: ${{ secrets.LOKALISE_API_TOKEN }}
          project_id: ${{ secrets.LOKALISE_PROJECT_ID }}
          base_lang: en
          file_ext: po
          translations_path: |
            .
            translations
          additional_params: >
            {
              "detect_icu_plurals": true,
              "convert_placeholders": true,
              "replace_modified": true,
              "cleanup_mode": false
            }
